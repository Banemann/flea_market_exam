{% include "_header.html" %}
{% include "_nav.html" %}

<main id="your-fleamarket" class="page"
mix-url="/your-fleamarket"
mix-bottom="body"
mix-title="{{ title | default('Company') }}"
mix-hide=".page"
mix-show="#your-fleamarket">

{% include "_profile_nav.html" %}

<h1>Your fleamarket</h1>
{% if session.user %}

<div class="edit-profile">    
    <div class="message-container">
        {% if message %}
        <div class="success-message">
            {{ message }}
        </div>
        {% endif %}
        
        {% if error_message %}
        <div class="error-message">
            {{ error_message }}
        </div>
        {% endif %}
    </div>



{% if user_fleamarket %}
<div class="fleamarket-images">
    <div class="main-image">
        <img src="/static/uploads/{{ user_fleamarket.item_image }}" alt="{{ user_fleamarket.item_name }}">
    </div>
    
    {% if additional_images %}

        <div class="additional-images">
            {% for image in additional_images %}
                <img src="/static/uploads/{{ image }}" alt="Additional image for {{ user_fleamarket.item_name }}">
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endif %}


    {% if user_fleamarket %}

        <h2>Edit your fleamarket</h2>
        <form mix-post="/your-fleamarket/update" class="fleamarket-form" enctype="multipart/form-data">
            <input type="hidden" name="item_pk" value="{{ user_fleamarket.item_pk }}">
            <div>
                <label for="">
                    <span>Fleamarket name</span>
                </label>
                <input name="item_name" type="text" mix-check="{{ x.ITEM_NAME_REGEX }}" value="{{ user_fleamarket.item_name }}">
            </div> 
    
            <div>
                <label for="">
                    <span>Address</span>
                </label>
                <input name="item_address" type="text" mix-check="{{ x.ITEM_ADDRESS_REGEX }}" value="{{ user_fleamarket.item_address }}">
            </div>
    
            <div>
                <label for="fleamarket-images">
                    <span>Images (Upload up to 3 images)</span>
                </label>
                <input type="file" id="fleamarket-images" name="files" multiple accept="image/png, image/jpeg, image/jpg, image/gif" class="file-input">
                {% if user_fleamarket.item_image %}
                    <small>Current main image: {{ user_fleamarket.item_image }}</small>
                {% endif %}
            </div>
    
            <div>
                <label for="">
                    <span>Ticket price (DKK)</span>
                </label>
                <input name="item_price" type="text" mix-check="{{ x.ITEM_PRICE_REGEX }}" value="{{ user_fleamarket.item_price }}">
            </div>
    
            <div>
                <label for="">
                    <span>Latitude</span>
                </label>
                <input name="item_latitude" type="text" mix-check="{{ x.ITEM_LATITUDE_REGEX }}" value="{{ user_fleamarket.item_lat }}">
            </div>
    
            <div>
                <label for="">
                    <span>Longitude</span>
                </label>
                <input name="item_longitude" type="text" mix-check="{{ x.ITEM_LONGITUDE_REGEX }}" value="{{ user_fleamarket.item_lon }}">
            </div>
            <div class="button-group">
                <button
                type="submit"
                mix-await="Updating..."
                mix-default="Update">
                    Update
                </button>
            </div>
        </form>

        <form mix-post="/your-fleamarket/delete" style="margin-top: 10px;">
            <input type="hidden" name="item_pk" value="{{ user_fleamarket.item_pk }}">
            <button type="submit" class="delete-btn" mix-await="Deleting..." mix-default="Delete Fleamarket">
                Delete Fleamarket
            </button>
        </form>

    {% else %}
        
        <h2>Register your fleamarket</h2>
        <form mix-post="/your-fleamarket" enctype="multipart/form-data">
            <div>
                <label for="">
                    <span>Fleamarket name</span>
                </label>
                <input name="item_name" type="text" mix-check="{{ x.ITEM_NAME_REGEX }}">
            </div> 
    
            <div>
                <label for="">
                    <span>Address</span>
                </label>
                <input name="item_address" type="text" mix-check="{{ x.ITEM_ADDRESS_REGEX }}">
            </div>
    
            <div>
                <label for="new-fleamarket-images">
                    <span>Images (Upload up to 3 images)</span>
                </label>
                <input type="file" id="new-fleamarket-images" name="files" multiple accept="image/png, image/jpeg, image/jpg, image/gif" class="file-input">
            </div>
    
            <div>
                <label for="">
                    <span>Ticket price (DKK)</span>
                </label>
                <input name="item_price" type="text" mix-check="{{ x.ITEM_PRICE_REGEX }}">
            </div>
    
            <div>
                <label for="">
                    <span>Latitude</span>
                </label>
                <input name="item_latitude" type="text" mix-check="{{ x.ITEM_LATITUDE_REGEX }}">
            </div>
    
            <div>
                <label for="">
                    <span>Longitude</span>
                </label>
                <input name="item_longitude" type="text" mix-check="{{ x.ITEM_LONGITUDE_REGEX }}">
            </div>
            <button
            mix-await="Please wait..."
            mix-default="Add">
                Add
            </button>
        </form>
    {% endif %}
</div>

{% else %}
<p>You are not logged in.</p>
{% endif %}
</main>

{% include "_footer.html" %}